---
// src/pages/[...slug].astro
import { getCollection } from "astro:content";
import Base from "../layouts/base/base.astro";
import { segmentsFromSlug, permalinkFromSlug } from "../lib/permalinks";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    posts.sort((a,b) => +b.data.date - +a.data.date);

    return posts.map((post) => ({
        params: { slug: segmentsFromSlug(post.slug).join("/") },
        props: { post },
    }));
}

const { post } = Astro.props;
const canonical = permalinkFromSlug(post.slug);
---

<Base title={post.data.title} url={`https://limecoder.com${canonical}`} description={post.data.excerpt}>
    <article class="max-w-3xl mx-auto px-4 sm:px-6 py-8">
        <h1 class="font-display text-3xl sm:text-4xl text-white leading-tight">{post.data.title}</h1>
        <div class="mt-3 flex flex-wrap items-center gap-2 text-sm text-[var(--color-ink-muted)]">
            <span>{(post.data.date instanceof Date ? post.data.date : new Date(post.data.date)).toLocaleDateString()}</span>
            {post.data.tags?.length && <span aria-hidden="true">â€¢</span>}
            {post.data.tags?.map((t) => <span class="rounded-lg bg-[#26361e] text-[#bdeb7f] px-2 py-0.5">{t}</span>)}
        </div>
        {post.data.image && <img src={post.data.image} alt="" class="mt-6 w-full rounded-xl border border-white/10 object-cover" />}
        <div class="prose prose-invert max-w-none mt-8" set:html={post.body} />
    </article>
</Base>