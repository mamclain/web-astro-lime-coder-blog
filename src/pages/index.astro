---
import Base from "../layouts/base/base.astro";
import Hero from "../components/hero/hero.astro";
import PostGrid from "../components/post_grid/post_grid.astro";
import { getCollection } from "astro:content";
import {permalinkFromSlug} from "../lib/permalinks";

let  posts = await getCollection("blog");
posts = [
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
    ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts, ...posts,
];

// sort newest first
posts.sort((a,b) => +b.data.date - +a.data.date);

// reading time helper (â‰ˆ200 wpm)
const rt = ({body}: { body: any }) => {
    return Math.max(1, Math.round((body.split(/\s+/).length || 0) / 200));
};


const items = posts.map((p) => ({
    href: permalinkFromSlug(p.slug),
    title: p.data.title,
    excerpt: p.data.excerpt,
    date: p.data.date,
    image: p.data.image,
    tags: p.data.tags ?? [],
    minutes: rt({ body: p.body }),
    watermarkSrc: "/images/posts/lime_snake.png",
}));

const url = "https://limecoder.com";
const description = "Lime Coder is a personal blog dedicated to programming and other artistic interests.";
---

<Base ...>
    <div class="flex flex-col min-h-dvh">
        <!-- Sticky Hero -->
        <div class="shrink-0 sticky top-0 z-40 bg-white">
            <Hero />
        </div>

        <!-- Scrollable posts area -->
        <div class="flex-1 overflow-y-auto px-4 sm:px-8 pb-8 pt-4"
             style="max-height: calc(100vh - 300px);">
            <PostGrid
                    items={items}
                    initialCount={12}
                    step={8}
                    keepMax={60}
            />
            <div class="h-16 sm:h-20"></div> <!-- bottom spacer -->
        </div>
    </div>
</Base>

